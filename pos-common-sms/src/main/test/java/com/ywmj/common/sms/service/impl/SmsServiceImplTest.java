package com.ywmj.common.sms.service.impl;

import base.BaseTest;
import com.google.common.base.Predicate;
import com.google.common.collect.Iterables;
import com.google.common.collect.Lists;
import com.ywmj.common.sms.service.SmsService;
import org.junit.Test;

import javax.annotation.Resource;
import java.util.List;

/**
 * Sms单元测试
 *
 * Created by cc on 16/6/12.
 */
public class SmsServiceImplTest extends BaseTest {

    @Resource
    private SmsService smsService;

    /**
     * 不要随意执行这个Demo
     */
    @Test
    public void testBatchSendTmp() {
        String msg = "尊敬的用户，您好，您之前下载注册了鹦鹉美家APP。为提高服务质量、提供更多用户优惠，稍后会有客服人员电话回访并送上礼品答谢！";

        List<String> before = Lists.newArrayList("18701172397", "13008106303","13032899023","13100402790","13141268838","13285266108","13308088274","13438385096","13527308680","13541237081","13541331927","13550246296","13558756061","13699440944","13701099350","13751866080","13757181759","13808031127","13808086609","13808359510","13880167618","13881813372","13883439898","13883926113","13911535230","13980090519","15283862952","15310983833","15723107008","15756380698","15820350854","15902811338","15923529481","15983627605","15984979040","15988441383","17783503053","18011517986","18108098162","18144351986","18160023800","18180746992","18180817875","18193625076","18225054751","18280088482","18280231420","18281012911","18483683220","18508108004","18508290735","18523070056","18574628866","18580221989","18602866488","18613231185","18623190350","18683950886","18723885083","18730716301","18780051926","18780062913","18858118188","18917520999","18962532901","18981778900","18996479728");
        List<String> after = Lists.newArrayList("17308076679", "15922538581","13399851313","15086800098","13236547603","13612735287","13240674101","17099266408","17083098982","15546205401","13423661282","18302423868","13267479044","17130283347","13763242359","17089830887","15640226774","18304086395","17067912548","17186427164","13222049419","13108513447","17188230944","17098199437","17186800917","15669864601","17080388003","17083883423","17180438381","17078419181","17131030450","17092991849","17071461641","15360271163","15042033347","18575192604","15512044767","15524142116","15546783265","13270747264","15625971672","18819767215","15241904244","13215305385","17081124854","17070710408","18382839051","17898180006","18030778617","13896374166","18908372387","15123959067","18696657060","15888096212","18683579855","13908306996","18723292223","15123310840","13368333182");
        Iterable<String> filtered = Iterables.filter(after, new Predicate<String>() {
            @Override
            public boolean apply(String s) {
                return !before.contains(s);
            }
        });
        smsService.sendMessageBatch(Lists.newArrayList(filtered), msg);
    }
}