<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.pos.im.dao.SessionMessageDao">

    <insert id="saveBatch" parameterType="java.util.List">
        INSERT INTO
        im_session_message (session_id, user_id, user_type, msg_type, content, send_time)
        VALUES
        <foreach collection="list" item="message" index="index" separator=",">
            (#{message.sessionId}, #{message.userId}, #{message.userType},
            #{message.msgType}, #{message.content}, #{message.sendTime})
        </foreach>
    </insert>

    <select id="countBySessionId" resultType="int">
        SELECT
        COUNT(*)
        FROM im_session_message msg
        WHERE msg.session_id = #{sessionId}
    </select>

    <select id="findListBySessionId" resultType="com.pos.im.dto.message.SessionMessageDto">
        SELECT
        <include refid="messageDtoColumns"/>
        FROM im_session_message msg
        WHERE msg.session_id = #{sessionId}
        <if test="orderHelper != null">
            ORDER BY ${orderHelper.fieldName} ${orderHelper.ordination}
        </if>
        LIMIT #{limitHelper.offset}, #{limitHelper.pageSize}
    </select>

    <sql id="messageDtoColumns">
        msg.id as id,
        msg.session_id as sessionId,
        msg.user_id as userId,
        msg.user_type as userType,
        msg.msg_type as msgType,
        msg.content as content,
        msg.send_time as sendTime
    </sql>

</mapper>