<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.pos.im.dao.UserInfoDao">

    <insert id="save" parameterType="com.pos.im.domain.UserInfo">
        INSERT INTO im_user_info
        (
            user_id,
            user_type,
            im_uid,
            user_detail_type,
            user_title,
            show_name,
            show_head,
            company_id,
            gender,
            phone,
            public_phone,
            create_time,
            update_time,
            available)
        VALUES
        (
            #{ui.userId},
            #{ui.userType},
            #{ui.imUid},
            #{ui.userDetailType},
            #{ui.userTitle},
            #{ui.showName},
            #{ui.showHead},
            #{ui.companyId},
            #{ui.gender},
            #{ui.phone},
            #{ui.publicPhone},
            #{ui.createTime},
            #{ui.updateTime},
            #{ui.available}
        )
    </insert>

    <update id="update" parameterType="com.pos.im.domain.UserInfo">
        UPDATE im_user_info
        SET
        user_detail_type = #{ui.userDetailType},
        user_title = #{ui.userTitle},
        show_name = #{ui.showName},
        show_head = #{ui.showHead},
        gender = #{ui.gender},
        phone = #{ui.phone},
        public_phone = #{ui.publicPhone},
        append_greeting = #{ui.appendGreeting},
        update_time = #{ui.updateTime},
        available = #{ui.available},
        im_uid = #{ui.imUid}
        WHERE id = #{ui.id}
    </update>

    <update id="updateByUser" parameterType="com.pos.im.domain.UserInfo">
        UPDATE im_user_info
        SET
        user_detail_type = #{ui.userDetailType},
        user_title = #{ui.userTitle},
        show_name = #{ui.showName},
        show_head = #{ui.showHead},
        gender = #{ui.gender},
        phone = #{ui.phone},
        public_phone = #{ui.publicPhone},
        append_greeting = #{ui.appendGreeting},
        update_time = #{ui.updateTime},
        available = #{ui.available},
        im_uid = #{ui.imUid}
        WHERE user_id = #{ui.userId} AND user_type = #{ui.userType}
    </update>

    <select id="find" resultType="com.pos.im.domain.UserInfo">
        SELECT
        <include refid="imUserInfoColumns" />
        FROM im_user_info ui
        WHERE ui.user_id = #{userId} AND ui.user_type = #{userType}
        <if test="available != null">
            AND ui.available = #{available}
        </if>
    </select>

    <select id="findByPhone" resultType="com.pos.im.domain.UserInfo">
        SELECT
        <include refid="imUserInfoColumns" />
        FROM im_user_info ui
        WHERE ui.phone = #{phone} AND ui.user_type = #{userType}
        <if test="available != null">
            AND ui.available = #{available}
        </if>
    </select>

    <select id="findUsers" resultType="com.pos.im.domain.UserInfo">
        SELECT
        <include refid="imUserInfoColumns" />
        FROM im_user_info ui
        WHERE ui.user_id IN
        <foreach collection="usersId" item="userId" index="index" open="(" separator="," close=")">
            #{userId}
        </foreach>
        AND ui.user_type = #{userType}
        <if test="available != null">
            AND ui.available = #{available}
        </if>
    </select>

    <sql id="imUserInfoColumns">
        ui.id as id,
        ui.user_id as userId,
        ui.user_type as userType,
        ui.im_uid as imUid,
        ui.user_detail_type as userDetailType,
        ui.user_title as userTitle,
        ui.show_name as showName,
        ui.show_head as showHead,
        ui.company_id as companyId,
        ui.gender as gender,
        ui.phone as phone,
        ui.public_phone as publicPhone,
        ui.append_greeting as appendGreeting,
        ui.create_time as createTime,
        ui.update_time as updateTime,
        ui.available as available
    </sql>

</mapper>