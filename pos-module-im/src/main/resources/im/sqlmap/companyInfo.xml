<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.pos.im.dao.CompanyInfoDao">

    <insert id="save" parameterType="com.pos.im.domain.CompanyInfo">
        INSERT INTO im_company_info
        (company_id, `name`, area_id, address, logo_image,
        create_time, update_time, available, im_sms_enable, im_notice_enable)
        VALUES
        (#{ci.companyId}, #{ci.name}, #{ci.areaId}, #{ci.address}, #{ci.logoImage},
        #{ci.createTime}, #{ci.updateTime}, #{ci.available}, #{ci.imSmsEnable}, #{ci.imNoticeEnable});
    </insert>

    <update id="update" parameterType="com.pos.im.domain.CompanyInfo">
        UPDATE im_company_info
        <set>
            <if test="ci.name != null">
                `name` = #{ci.name},
            </if>
            <if test="ci.areaId != null">
                area_id = #{ci.areaId},
            </if>
            <if test="ci.address != null">
                address = #{ci.address},
            </if>
            <if test="ci.logoImage != null">
                logo_image = #{ci.logoImage},
            </if>
            <if test="ci.updateTime != null">
                update_time = #{ci.updateTime},
            </if>
            <if test="ci.available != null">
                available = #{ci.available},
            </if>
            <if test="ci.imSmsEnable != null">
                im_sms_enable = #{ci.imSmsEnable},
            </if>
            <if test="ci.imNoticeEnable != null">
                im_notice_enable = #{ci.imNoticeEnable}
            </if>
        </set>
        WHERE id = #{ci.id}
    </update>

    <select id="findByCompanyId" resultType="com.pos.im.domain.CompanyInfo">
        SELECT
        <include refid="imCompanyInfoColumns" />
        FROM im_company_info ci
        WHERE ci.company_id = #{companyId}
    </select>

    <select id="findCompaniesBySessionId" resultType="com.pos.im.domain.CompanyInfo">
        SELECT
        <include refid="imCompanyInfoColumns" />
        FROM im_session se
        INNER JOIN im_session_company sc ON sc.session_id = se.id AND sc.available = 1
        INNER JOIN im_company_info ci ON ci.company_id = sc.company_id AND ci.available = 1
        WHERE se.id = #{sessionId}
    </select>

    <sql id="imCompanyInfoColumns">
        ci.id as id,
        ci.company_id as companyId,
        ci.name as `name`,
        ci.area_id as areaId,
        ci.address as address,
        ci.logo_image as logoImage,
        ci.create_time as createTime,
        ci.update_time as updateTime,
        ci.available as available,
        ci.im_sms_enable as imSmsEnable,
        ci.im_notice_enable as imNoticeEnable
    </sql>

</mapper>