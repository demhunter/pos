<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.pos.user.dao.v1_0_0.UserDao">
    <select id="getByUserPhone" resultType="com.pos.user.domain.v1_0_0.User">
        SELECT
        <include refid="userColumns"/>
        FROM `user` u
        WHERE u.phone = #{phone}
    </select>

    <select id="getByPhoneAndType" resultType="com.pos.user.domain.v1_0_0.User">

    </select>

    <insert id="save" parameterType="com.pos.user.domain.v1_0_0.User" useGeneratedKeys="true" keyProperty="user.id">
        INSERT INTO `user`(
            login_name,
            password,
            phone,
            enable_status,
            user_type,
            NOW()
        ) VALUE (
            #{user.loginName},
            #{user.password},
            #{user.phone},
            #{user.enable_status},
            #{user.user_type},
            #{user.updateTime}
        )
    </insert>

    <update id="update" parameterType="com.pos.user.domain.v1_0_0.User">

    </update>

    <insert id="saveExtension" parameterType="com.pos.user.domain.v1_0_0.UserExtension">
        INSERT INTO user_extension(
            user_id,
            register_time,
            register_info,
            last_login_time,
            last_login_info
        ) VALUE (
            #{extension.userId},
            #{extension.registerTime},
            #{extension.registerInfo},
            #{extension.lastLoginTime},
            #{extension.lastLoginInfo}
        )
    </insert>

    <select id="getExtension" resultType="com.pos.user.domain.v1_0_0.UserExtension">

    </select>

    <update id="updateExtension" parameterType="com.pos.user.domain.v1_0_0.UserExtension">

    </update>

    <select id="getByLoginName" resultType="com.pos.user.domain.v1_0_0.User">

    </select>

    <select id="queryCustomerUserIds" resultType="java.lang.Long">
        SELECT u.id AS id
        FROM `user` u
        JOIN user_customer_personal AS ucp ON ucp.user_id = u.id
        <where>
            u.user_type = 'c'
            <if test="condition.userPhone != null">
                AND u.phone = #{condition.userPhone}
            </if>
            <if test="condition.searchKey != null">
                AND ucp.real_name LIKE CONCAT('%',#{condition.searchKey},'%')
            </if>
        </where>
    </select>

    <sql id="userColumns">
        u.`id` AS `id`,
        u.login_name AS loginName,
        u.password AS password,
        u.phone AS phone,
        u.enable_status AS enableStatus,
        u.user_type AS userType,
        u.update_time AS updateTime
    </sql>
</mapper>